import{S as te,i as se,s as le,e as O,b as k,H as G,h as f,t as ne,w as re,k as w,a as x,q as N,l as E,m as P,c as B,r as L,n as v,G as g,J as q,K as M,L as oe,M as Q,N as J,u as ie,O as ae}from"../chunks/index.bfd2b3c6.js";function R(n,e,t){const o=n.slice();return o[22]=e[t],o}function ce(n){let e,t=[],o=new Map,s,r,a,y,u,h,b,T,_,i=n[5];const m=l=>l[22].id;for(let l=0;l<i.length;l+=1){let c=R(n,i,l),p=m(c);o.set(p,t[l]=X(p,c))}return{c(){e=w("div");for(let l=0;l<t.length;l+=1)t[l].c();s=x(),r=w("div"),a=w("textarea"),y=x(),u=w("button"),h=N("Send"),this.h()},l(l){e=E(l,"DIV",{class:!0});var c=P(e);for(let U=0;U<t.length;U+=1)t[U].l(c);c.forEach(f),s=B(l),r=E(l,"DIV",{class:!0});var p=P(r);a=E(p,"TEXTAREA",{class:!0,placeholder:!0}),P(a).forEach(f),y=B(p),u=E(p,"BUTTON",{class:!0});var I=P(u);h=L(I,"Send"),I.forEach(f),p.forEach(f),this.h()},h(){v(e,"class","h-[80vh] overflow-auto bg-white p-6 rounded-md shadow-md space-y-4"),v(a,"class","flex-grow mr-2 border-gray-300 shadow-sm rounded-md px-3 py-2 bg-white text-gray-700"),v(a,"placeholder","Your message..."),v(u,"class",b="bg-blue-500 text-white rounded px-4 py-2 "+(n[6]?"opacity-50 cursor-not-allowed":"")),u.disabled=n[6],v(r,"class","flex items-center justify-between mt-4")},m(l,c){k(l,e,c);for(let p=0;p<t.length;p+=1)t[p]&&t[p].m(e,null);n[13](e),k(l,s,c),k(l,r,c),g(r,a),q(a,n[4]),g(r,y),g(r,u),g(u,h),T||(_=[M(a,"input",n[14]),M(a,"keydown",n[15]),M(u,"click",n[16])],T=!0)},p(l,c){c&160&&(i=l[5],t=oe(t,c,m,1,l,i,o,e,ae,X,null,R)),c&16&&q(a,l[4]),c&64&&b!==(b="bg-blue-500 text-white rounded px-4 py-2 "+(l[6]?"opacity-50 cursor-not-allowed":""))&&v(u,"class",b),c&64&&(u.disabled=l[6])},d(l){l&&f(e);for(let c=0;c<t.length;c+=1)t[c].d();n[13](null),l&&f(s),l&&f(r),T=!1,Q(_)}}}function de(n){let e,t,o,s,r,a,y,u,h,b,T,_=n[3]&&z();return{c(){e=w("p"),t=N("Please enter the IP address of the assistant server:"),o=x(),s=w("input"),r=x(),a=w("button"),y=N("Confirm"),u=x(),_&&_.c(),h=O(),this.h()},l(i){e=E(i,"P",{class:!0});var m=P(e);t=L(m,"Please enter the IP address of the assistant server:"),m.forEach(f),o=B(i),s=E(i,"INPUT",{class:!0,placeholder:!0}),r=B(i),a=E(i,"BUTTON",{class:!0});var l=P(a);y=L(l,"Confirm"),l.forEach(f),u=B(i),_&&_.l(i),h=O(),this.h()},h(){v(e,"class","text-lg text-gray-700"),v(s,"class","border-gray-300 shadow-sm rounded-md px-3 py-2 bg-white text-gray-700"),v(s,"placeholder","Enter IP here"),v(a,"class","bg-blue-500 text-white rounded-md px-3 py-2 mt-2 hover:bg-blue-700 transition-colors")},m(i,m){k(i,e,m),g(e,t),k(i,o,m),k(i,s,m),q(s,n[1]),k(i,r,m),k(i,a,m),g(a,y),k(i,u,m),_&&_.m(i,m),k(i,h,m),b||(T=[M(s,"input",n[10]),M(s,"keydown",n[11]),M(a,"click",n[12])],b=!0)},p(i,m){m&2&&s.value!==i[1]&&q(s,i[1]),i[3]?_||(_=z(),_.c(),_.m(h.parentNode,h)):_&&(_.d(1),_=null)},d(i){i&&f(e),i&&f(o),i&&f(s),i&&f(r),i&&f(a),i&&f(u),_&&_.d(i),i&&f(h),b=!1,Q(T)}}}function ue(n){let e;return{c(){e=N("System:")},l(t){e=L(t,"System:")},m(t,o){k(t,e,o)},d(t){t&&f(e)}}}function fe(n){let e;return{c(){e=N("Bot:")},l(t){e=L(t,"Bot:")},m(t,o){k(t,e,o)},d(t){t&&f(e)}}}function _e(n){let e;return{c(){e=N("You:")},l(t){e=L(t,"You:")},m(t,o){k(t,e,o)},d(t){t&&f(e)}}}function X(n,e){let t,o,s,r,a,y,u,h=e[22].text+"",b,T,_;function i(c,p){return c[22].sender===c[7].User?_e:c[22].sender===c[7].Assistant?fe:ue}let m=i(e),l=m(e);return{key:n,first:null,c(){t=w("div"),o=w("div"),s=w("div"),r=w("p"),l.c(),a=x(),y=w("div"),u=w("p"),b=N(h),T=x(),this.h()},l(c){t=E(c,"DIV",{class:!0});var p=P(t);o=E(p,"DIV",{class:!0});var I=P(o);s=E(I,"DIV",{class:!0});var U=P(s);r=E(U,"P",{});var W=P(r);l.l(W),W.forEach(f),U.forEach(f),a=B(I),y=E(I,"DIV",{class:!0});var Y=P(y);u=E(Y,"P",{class:!0});var K=P(u);b=L(K,h),K.forEach(f),Y.forEach(f),I.forEach(f),T=B(p),p.forEach(f),this.h()},h(){v(s,"class","sender-container svelte-1y3fey0"),v(u,"class","message-text svelte-1y3fey0"),v(y,"class","message-container svelte-1y3fey0"),v(o,"class","flex"),v(t,"class",_=J(`p-4 rounded-md shadow-sm ${e[22].sender===e[7].User?"bg-blue-200 text-blue-800":e[22].sender===e[7].Assistant?"bg-green-200 text-green-800":"bg-gray-200 text-gray-800"}`)+" svelte-1y3fey0"),this.first=t},m(c,p){k(c,t,p),g(t,o),g(o,s),g(s,r),l.m(r,null),g(o,a),g(o,y),g(y,u),g(u,b),g(t,T)},p(c,p){e=c,m!==(m=i(e))&&(l.d(1),l=m(e),l&&(l.c(),l.m(r,null))),p&32&&h!==(h=e[22].text+"")&&ie(b,h),p&32&&_!==(_=J(`p-4 rounded-md shadow-sm ${e[22].sender===e[7].User?"bg-blue-200 text-blue-800":e[22].sender===e[7].Assistant?"bg-green-200 text-green-800":"bg-gray-200 text-gray-800"}`)+" svelte-1y3fey0")&&v(t,"class",_)},d(c){c&&f(t),l.d()}}}function z(n){let e,t;return{c(){e=w("p"),t=N("The IP address you entered is invalid. Please try again."),this.h()},l(o){e=E(o,"P",{class:!0});var s=P(e);t=L(s,"The IP address you entered is invalid. Please try again."),s.forEach(f),this.h()},h(){v(e,"class","text-lg text-red-500 mt-2")},m(o,s){k(o,e,s),g(e,t)},d(o){o&&f(e)}}}function he(n){let e;function t(r,a){return r[2]?ce:de}let o=t(n),s=o(n);return{c(){s.c(),e=O()},l(r){s.l(r),e=O()},m(r,a){s.m(r,a),k(r,e,a)},p(r,[a]){o===(o=t(r))&&s?s.p(r,a):(s.d(1),s=o(r),s&&(s.c(),s.m(e.parentNode,e)))},i:G,o:G,d(r){s.d(r),r&&f(e)}}}const pe=/^(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))$/;function me(n,e){return e=e||2e3,new Promise(function(t,o){const s=new WebSocket(n),r=setTimeout(function(){o(new Error("webSocket timeout")),a(),s.close()},e);function a(){clearTimeout(r),s.removeEventListener("error",y)}function y(u){o(u),a()}s.addEventListener("open",function(){t(s),a()}),s.addEventListener("error",y)})}function ye(n,e){return!n.includes(e)&&![...Array(e.length).keys()].some(t=>n.endsWith(e.slice(0,t+1)))}function be(n,e){return n.includes(e)}function F(n,e){n=n.split(e)[0];for(let t=e.length;t>0;t--)if(n.endsWith(e.slice(0,t)))return n.slice(0,-t);return n}function ve(n,e,t){var o=(d=>(d[d.User=0]="User",d[d.Assistant=1]="Assistant",d[d.System=2]="System",d))(o||{});let s,r="",a=!1,y=!1,u="",h=[{id:0,sender:1,text:"Hello, how can I assist you today?"}],b=!1;async function T(d){d&&(await ne(),d.scrollTo(0,d.scrollHeight))}const _=(d,A)=>{const H=h.length>0?h[h.length-1].id:0;h.push({id:H+1,sender:d,text:A}),t(5,h)},i=()=>{let d="";const A=`
User`,H=()=>{t(6,b=!1),S.close()},C=D=>{t(5,h[h.length-1].text+=D,h)},$=D=>{if(D!==""){if(d+=D,ye(d,A))C(D),d="";else if(be(d,A)){let V=F(d,A);V!==""&&C(V),H()}}else{let V=F(d,A);V!==""&&C(V),H()}};let S;return t(6,b=!0),me(`wss://${r}:8765/chat`,3e3).then(D=>{S=D,S.onmessage=j=>{const ee=j.data;$(ee)},S.onerror=j=>{_(2,"Lost connection.")},S.onclose=()=>{t(6,b=!1)},console.log("Connection to assistant server is open!"),_(0,u),_(1,""),t(4,u="");let V=m(h);S.send(V)}).catch(D=>{_(2,"Could not connect to assistant server."),t(6,b=!1)}),S},m=d=>{const A="You are a helpful assistant.",H=d.filter(C=>C.sender!==2).map(C=>`${C.sender===0?"User":"Assistant"}: ${C.text}`).join(`
`);return`${A}

${H}`},l=()=>{i()};function c(d){pe.test(d)?(t(2,a=!0),t(3,y=!1)):t(3,y=!0)}function p(){r=this.value,t(1,r)}const I=d=>d.key==="Enter"&&c(r),U=()=>c(r);function W(d){re[d?"unshift":"push"](()=>{s=d,t(0,s)})}function Y(){u=this.value,t(4,u)}const K=d=>{d.key==="Enter"&&!d.shiftKey&&!b&&l(),d.key==="Enter"&&!d.shiftKey&&d.preventDefault()},Z=()=>!b&&l();return n.$$.update=()=>{n.$$.dirty&1&&T(s)},[s,r,a,y,u,h,b,o,l,c,p,I,U,W,Y,K,Z]}class ge extends te{constructor(e){super(),se(this,e,ve,he,le,{})}}export{ge as component};
